<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Agriculture App</title>
    
    <base href="/" />
    
    <meta name="color-scheme" content="light dark" />
    <meta
      name="viewport"
      content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    
    <link rel="manifest" href="/manifest.json" />
    
    <link rel="shortcut icon" type="image/png" href="/favicon.png" />
    
    <!-- add to homescreen for ios -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="Ionic App" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  </head>
  <body>
    
    <div id="marker"></div>
    <button id="closecam" autoplay>CLOSE</button>
    <video id="vid"></video>
    <div id="frstpgtitle" class="title">Your Location</div>
    <div id="scndpgtitle" class="title">Field details</div>
    <div class="page" id="zeropg">
      <div id="appicon"></div>
      <p id="appname">AgriBuddy</p>
    </div>
    <div class="page" id="firstpg"></div>
    <div class="page" id="secondpg"></div>
    <div class="page" id="thirdpg">
      <button class="dashboardbut" id="overview">GPSdata</button>
      <button class="dashboardbut" id="detailed">Detailed</button>
      <button class="dashboardbut" id="diseasediag">Health</button>
      <textarea id="responseTextarea" cols="40" rows="10"></textarea>
      <textarea id="healthTextarea" cols="40" rows="10"></textarea>
      <textarea class="inputtop" id="plantdiagnose" cols="20" rows="2">Enter crop</textarea>
      <video id="video">Video Stream not available</video>
      <button id="startbutton2">Take photo</button>
      <button id="startbutton">Start Video</button>
      
      <div id="webcam-container"></div>
      <div id="label-container"></div>
      <div id="loadingicon"></div>
      <p id="ar">Area</p>
      <table id="tbl">
        <tr>
          <th>Latitude</th>
          <th>Longitude</th>
        </tr>
      </table>
    </div>
    <div id="empty"></div>
    <div id="footer">Dashboard</div>
    <div id="root"></div>
    <textarea id="state" class="inputtop" cols="20" rows="2">Enter state</textarea>
    <textarea id="district" class="inputmid" cols="20" rows="2">Enter district</textarea>
    <textarea id="profilename" class="inputmid" cols="20" rows="2">Enter profile name</textarea>
    <textarea id="enterarea" class="inputtop" cols="20" rows="2">Enter area</textarea>
    

    <div id="state" class="inputmid" class="or">or</div>
    <div id="or2" class="inputmid" class="or">or</div>
    <button id="calarea" class="inputmid" autoplay>Map your field</button>
    <button id="getloc" class="inputmid">get location</button>
    <button id="markcoord">START</button>
    <button id="next" class="inputmid">Next</button>
    <!-- <button id="previous" class="inputmid">Previous</button> -->
    <button id="next2" class="inputmid">Next</button>
    <button id="previous2" class="inputmid">Previous</button>
    <div id="canvpreview">Preview:-</div>
    <canvas id="myCanvas"></canvas>
    <div id="profileicon"></div>
    <div id="popup">
      <table id="tblpop">
        <tr>
          <th>Profile</th>
        </tr>
      </table>
      <button id="newbut">New profile</button>
    </div>
    
    
  <style>
    body{
      background-color: greenyellow;
      scroll-snap-type: mandatory;
      overflow: hidden;
    }

    #tblpop{
      position: relative;
      top: 10%;
      left: 5%;
      width: 60%;
      font-size: x-large;
    }

    #startbutton{
      position: absolute;
      top: 80%;
      left: 35%;
      height: 6%;
      border-radius: 100%;
      font-weight: bold;
      background-color: greenyellow;
      /* z-index: +2; */
    }

    #webcam-container{
      position: absolute;
      top: 30%;
      left: 10%;
    }

    #startbutton2{
      position: absolute;
      top: 80%;
      left: 35%;
      height: 6%;
      border-radius: 100%;
      font-weight: bold;
      background-color: greenyellow;
      /* z-index: -1; */
    }

    #loadingicon{
      position: relative;
      top: -45%;
      left: 30%;
      background-color: black;
      background-image: url(https://www.shutterstock.com/image-vector/industrial-agricultural-icon-260nw-526588474.jpg);
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
      width: 150px;
      aspect-ratio: 1/1;
      border-radius: 70px;
      z-index: +100;
      /* animation-name: rot;
      animation-duration: 3s;
      animation-iteration-count: 5; */
    }

    @keyframes rot {
  0% {transform: rotate(0deg)}
  50% {transform: rotate(180deg)}
  100% {transform: rotate(360deg)}
}

    #ar{
      position: absolute;
      top: 65%;
      left: 30%;
      font-size: larger;
    }

    html{
      scroll-snap-type: mandatory;
      scroll-behavior: smooth;
    }

    #tbl{
      position: relative;
      top: 65%;
      width: 100%;
      text-align: center;
    }

    td, th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;
}

  #appicon{
      position: relative;
      top: 30%;
      left: 30%;
      width: 40%;
      aspect-ratio: 1/1;
      background-color: gainsboro;
      background-image: url(https://www.shutterstock.com/image-vector/industrial-agricultural-icon-260nw-526588474.jpg);
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
      border-radius: 100px;
    
  }

    #appname{
      position: relative;
      top: 30%;
      left: 29%;
      font-size: xx-large;
      font-family:'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
    }

    #profileicon{
      position: absolute;
      top: 2%;
      left: 285%;
      width: 10%;
      aspect-ratio: 1/1;
      background-color: gainsboro;
      background-image: url(https://png.pngtree.com/png-clipart/20200224/original/pngtree-avatar-icon-profile-icon-member-login-vector-isolated-png-image_5247852.jpg);
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
      border-radius: 50px;
    }

    #popup{
      position: absolute;
      bottom: 0%;
      height: 60%;
      width: 100%;
      background-color: whitesmoke;
      border-radius: 2%;
      left: 200%;
      z-index: +2;
    }

    #newbut{
      position: relative;
      width: 25%;
      top: 80%;
      left: 37%;
      aspect-ratio: 2/1;
      background-color: green;
      color: aliceblue;
      font-size: larger;
      border-radius: 30px;
    }

    #next {
      top: 70%;
      left: 53%;
      width: 30%;
      height: 5%;
      font-size: larger;
      border-radius: 20px;
      background-color: greenyellow;
      z-index: +10;
    }

    #previous {
      top: 50%;
      left: 13%;
      width: 30%;
      height: 5%;
      font-size: larger;
      border-radius: 20px;
      background-color: greenyellow;
      z-index: +10;
    }

    #next2 {
      top: 25%;
      left: 153%;
      width: 30%;
      height: 5%;
      font-size: larger;
      border-radius: 20px;
      background-color: greenyellow;
      z-index: +1;
    }

    #previous2 {
      top: 25%;
      left: 113%;
      width: 30%;
      height: 5%;
      font-size: larger;
      border-radius: 20px;
      background-color: greenyellow;
      z-index: +1;
    }

    .or{
      color: black;
      font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
      border-radius: 0%;
      position: absolute;
      top: 30%;
      resize: none;
      font-size: xx-large;
      overflow: hidden;
      height: 4%;
    }

    video {
        position: absolute;
        left: 103%;
        top: 2%;
        width: 94%;
        height: 0%;
        object-fit: cover;
        z-index: +2;
        
    }

    #myCanvas{
      position: absolute;
      bottom: 7%;
      height: 50%;
      /*height: 500px;*/
      width: 94%;
      /*width: 500px;*/
      background-color: white;
      border-style: solid;
      border-width: 1px;
      left: 103%;
    }

    #closecam {
      position: absolute;
        left: 105%;
        bottom: 10%;
        width: 15%;
        aspect-ratio: 1/1;
        object-fit: cover;
        z-index: +3;
        border-radius: 100px;
        background-color: red;
        font-weight:800;
        /* display: hidden; */
    }

    #markcoord {
      position: absolute;
        left: 140%;
        bottom: 10%;
        width: 15%;
        aspect-ratio: 1/1;
        font-size: small;
        text-align: center;
        object-fit: cover;
        z-index: +3;
        border-radius: 100px;
        background-color: green;
        /* display: hidden; */
    }

    #frstpgtitle{
           left: 4%;
           color: black;
           font-family: 'Courier New', Courier, monospace;
    }

    #scndpgtitle{
           left: 104%;
           width: 50%;
           color: black;

    }

    .title{
      font-size: xx-large;
      font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
      position: absolute;
      top: 3%;
      z-index: +1;
    }

    #area{
      left: 108%;
    }

    #calarea{
      left: 123%;
      width: 50%;
      height: 5%;
      font-size: larger;
      border-radius: 20px;
      background-color: greenyellow;
      top: 17%;
    }

    #or2{
      position: absolute;
      left: 110%;
      top: 17%;
    }

    #enterarea{
      left: 113%;
      top: 10%;
    }

    #plantdiagnose{
      position: relative;
      left: 10%;
      top: 9%;
      /* display: none; */
    }

    #canvpreview{
      position: absolute;
      left: 103%;
      top: 39%;
      font-size: xx-large;
    }
    
    #getloc{
      left: 28%;
      width: 40%;
      height: 5%;
      font-size: larger;
      border-radius: 20px;
      background-color: greenyellow;
    }

    #prvcrops{
      top: 40%;
      left: 108%;
    }

    .inputtop{
      background-color: white;
      position: absolute;
      top: 20%;
      resize: none;
      font-size: xx-large;
      overflow: hidden;
      height: 4%;
      border-radius: 30px;
      color: black;
    }

    .inputmid{
      background-color: white;
      position: absolute;
      top: 30%;
      resize: none;
      font-size: xx-large;
      overflow: hidden;
      height: 4%;
      border-radius: 30px;
      color: black;
    }

    #responseTextarea{
      position: relative;
      top: 10%;
      left: 0%;
      height: 85%;
      width: 99%;
      font-size: xx-large;
      resize: none;
      color: black;
      background-color: white;
      z-index: +1;
    }

    #healthTextarea{
      position: absolute;
      top: 20%;
      left: 0%;
      height: 80%;
      width: 99%;
      font-size: xx-large;
      resize: none;
      color: black;
      background-color: white;
      z-index: -0.5;
      /* display: none; */
    }

    #profilename{
      left: 8%;
      top: 60%;
    }

    #state{
      left: 8%;

    }

    #district{
      left: 8%;
      top: 40%;
    }

    #empty{
      position: absolute;
      left: 0%;
      bottom: 0%;
      width: 300%;
      height: 1px;
    }

    #footer{
      position: absolute;
      top: 0%;
      left: 200%;
      width: 100%;
      height: 6%;
      background-color: green;
      color: white;
      font-size: xx-large;
      text-align: left;
      padding-top: 4%;
      padding-left: 3%;
    }

    #zeropg{
      left: -100%;
      z-index: +15;
    }

    #firstpg {
      left: 3%;
    }

    #secondpg {
      left: 103%;
    }

    #thirdpg {
      left: 203%;
    }

    .dashboardbut{
      position: relative;
      width: 25%;
      aspect-ratio: 2/1;
      top: 7%;
      left: 12%;
      border-top-right-radius: 10px;
      border-top-left-radius: 10px;
      background-color: white;
      font-size: larger;
      text-align: center;
      border-style: solid;
      color: black;
      
    }

    .page{
      position: absolute;
      top: 2%;
      height: 95%;
      width: 94%;
      background-color: white;
      border-radius: 2%;
      scroll-snap-align: center;

    }
  </style>
    <script type="module" src="/src/main.tsx"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/haversine-distance@1.2.1/index.min.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
<script type="module">

import API_KEY from "/apikey.js"


const asin = Math.asin
const cos = Math.cos
const sin = Math.sin
const sqrt = Math.sqrt
const PI = Math.PI

// equatorial mean radius of Earth (in meters)
const R = 6378137

function squared (x) { return x * x }
function toRad (x) { return x * PI / 180.0 }
function hav (x) {
  return squared(sin(x / 2))
}

// hav(theta) = hav(bLat - aLat) + cos(aLat) * cos(bLat) * hav(bLon - aLon)
function haversineDistance (a, b) {
  const aLat = toRad(Array.isArray(a) ? a[1] : a.latitude || a.lat)
  const bLat = toRad(Array.isArray(b) ? b[1] : b.latitude || b.lat)
  const aLng = toRad(Array.isArray(a) ? a[0] : a.longitude || a.lng || a.lon)
  const bLng = toRad(Array.isArray(b) ? b[0] : b.longitude || b.lng || b.lon)

  const ht = hav(bLat - aLat) + cos(aLat) * cos(bLat) * hav(bLng - aLng)
  return 2 * R * asin(sqrt(ht))
}

let state = document.getElementById("state")
let getloc = document.getElementById("getloc")
let district = document.getElementById("district")
let calarea = document.getElementById("calarea")
let closecam = document.getElementById("closecam")
let markcoord = document.getElementById("markcoord")
let sidelat = []
let sidelon = []
let noofside = 0
// let marker = document.getElementById("marker")
let myCanvas = document.getElementById("myCanvas")
var ctx = myCanvas.getContext("2d");
var startcounter = 0
let geodist

let xposend = Math.floor(sidelat[noofside])
let yposend = Math.floor(sidelon[noofside])
let xpos = Math.floor(sidelat[noofside-1])
let ypos = Math.floor(sidelon[noofside-1])
let debx = 19.075984
let deby = 72.877656
let debxend = 28.6097408
let debyend = 77.3685248
let nextcounter = 0
let scrolltarget = screen.width
let next = document.getElementById("next")
let previous2 = document.getElementById("previous2")
let next2 = document.getElementById("next2")
let id;
let cachelat;
let cachelon;
let cachelat2;
let cachelon2;
let delcachelat = cachelat2-cachelat;
let delcachelon = cachelon2-cachelon;
let popup = document.getElementById("popup")
let profileicon = document.getElementById("profileicon")
let newbut = document.getElementById('newbut')
let popupcount = 1;
let maxX;
let maxY;
let cachesidelat = []
let cachesidelon = []
let hope;
let responseTextarea = document.getElementById("responseTextarea")
let canvpreview = document.getElementById("canvpreview")
let permstate;
let permarea;
let headarr = []
let distarr = []
let area;
let overview = document.getElementById("overview")
let detailed = document.getElementById("detailed")
let health = document.getElementById("diseasediag")
var table = document.getElementById("tbl");
let ar = document.getElementById("ar")
let loadingicon = document.getElementById("loadingicon")
let enterarea = document.getElementById("enterarea")
let magnification;
let slopearr = []
let x1;
let y1;
let pixxarr = []
let pixyarr =[]
let pixxdistarr = []
let pixydistarr = []
let magx;
let magy;
let trancount = 0;
let tblpop = document.getElementById("tblpop")




loadingicon.style.display = "none"
ar.style.display = "none"



detailed.addEventListener("click",()=>{
  myCanvas.style.display = "none"
  responseTextarea.style.display = "block"
  ar.style.display = "none"
})

overview.addEventListener("click",()=>{
  ar.style.display = "block"
  myCanvas.style.left = "203%"
  myCanvas.style.top = "15%"
  myCanvas.style.display = "block"
  responseTextarea.style.display = "none"
})

health.addEventListener("click",()=>{
  myCanvas.style.display = "none"
  responseTextarea.style.display = "none"
  ar.style.display = "none"
  table.style.display = "none"
})

canvpreview.style.display = "none"
popup.style.display = "none"

newbut.addEventListener("click",()=>{
  popup.style.display = "none"
  window.scrollTo(0,0)
  nextcounter=0
  scrolltarget = screen.width
})

profileicon.addEventListener("click",()=>{
  popupcount++
  if(popupcount%2==0){
    popup.style.display = "block"
}
else{
    popup.style.display = "none"
}
})


next.addEventListener("click",()=>{

window.scrollTo(scrolltarget,0)
scrolltarget += screen.width
nextcounter+=1
console.log(nextcounter)
localStorage.setItem("state", state.value);
localStorage.setItem("district", district.value);
})

next2.addEventListener("click", async (e)=>{
localStorage.setItem("area",enterarea.value)
e.preventDefault();


window.scrollTo(scrolltarget,0)
scrolltarget += screen.width
nextcounter+=1
console.log(nextcounter)
permstate = localStorage.getItem("state");
permarea = localStorage.getItem("area")
let mytext = "Give me an yearly planner for sowing crops in a"+" "+String(permarea)+" "+"metre square field in"+" "+permstate+" "+ "along with budget division among tools and crop seed price heading wise";

 if (mytext) {
        try {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${API_KEY}`,
                },
                body: JSON.stringify({
                    model: 'gpt-4',
                    messages: [{ role: 'user', content: mytext }],
                    temperature: 1.0,
                    top_p: 0.7,
                    n: 1,
                    stream: false,
                    presence_penalty: 0,
                    frequency_penalty: 0,
                }),
            });

            if (response.ok) {
                const data = await response.json();
                responseTextarea.value = data.choices[0].message.content;
            } else {
                responseTextarea.value = 'Error: Unable to process your request.';
            }
        } catch (error) {
            console.error(error);
            responseTextarea.value = 'Error: Unable to process your request.';
        }
    }

})

previous2.addEventListener("click",()=>{

window.scrollTo(-scrolltarget,0)
scrolltarget -= screen.width
if(nextcounter > 0){
nextcounter-=1
}
console.log(nextcounter)
})


myCanvas.style.display = "none"
// marker.style.display = "none"
closecam.style.display = "none"
markcoord.style.display = "none"
getloc.addEventListener("click",() => {

    if(navigator.geolocation){
      navigator.geolocation.watchPosition(showLocation)
    }
    else{
      console.log("some issue was present")
    }
})

const showLocation = async (position) => {

          sidelat.push(position.coords.latitude)
          sidelon.push(position.coords.longitude)
          headarr.push(position.coords.heading)

  //We user the NOminatim API for getting actual addres from latitude and longitude
   let response = await fetch(
     `https://nominatim.openstreetmap.org/reverse?lat=${position.coords.latitude}&lon=${position.coords.longitude}&format=json`
  );
  //store response object
  let data = await response.json();
  state.innerHTML = data.address.state
  district.innerHTML = data.address.state_district
  console.log(data.address)
  
};

function options (){
        enableHighAccuracy: true
        maximumAge: 1000;
        }

function error(err) {
        console.error(`ERROR(${err.code}): ${err.message}`);
        }


        calarea.addEventListener("click", () => {
          myCanvas.style.display = "block"
          // marker.style.display = "block"
          closecam.style.display = "block"
          markcoord.style.display = "block"
          canvpreview.style.display = "block"
        })
    
        closecam.addEventListener("click",()=>{
          closecam.style.display = "none"
          markcoord.style.display = "none"
          localStorage.setItem("area",enterarea.innerHTML)
          // marker.style.display = "none"
          // navigator.geolocation.clearWatch(id);
        })

        ctx.lineWidth = "2"
          ctx.strokeStyle = "black"
          ctx.beginPath()
          // ctx.moveTo(7,(myCanvas.height/2)+30)
          // console.log("sidelat",sidelat[0]," ","sidelon",sidelon[0])
          // ctx.moveTo(sidelat[0],sidelon[0])
          markcoord.addEventListener("click",()=>{
          let xcan1;
          let ycan1;
          // ctx.lineWidth = "2"
          // ctx.strokeStyle = "black"
          // ctx.beginPath()
          // ctx.moveTo(7,(myCanvas.height/2)+30)
          
        if(markcoord.innerHTML == "START"){
          noofside++
          // console.log("noofside",noofside)
          if(noofside == 1){
            xcan1 = 7
            ycan1 = (myCanvas.height/2)+30
            pixxarr.push(7)
            // pixyarr.push((myCanvas.height/2)+30)
            pixyarr.push(7)
            ctx.translate((-sidelat[0]+7)-(trancount*(-sidelat[0]+7)),(-sidelon[0]+7)-(trancount*(-sidelon[0]+7)))
            ctx.moveTo(sidelat[0],sidelon[0])
          }
          else{
            xcan1 = sidelat[sidelat.length-1]
            ycan1 = sidelon[sidelon.length-1]
          }
          
          // ctx.moveTo(debx,deby)
          // 
          
          console.log("pixxarr",pixxarr)
          console.log("pixyarr",pixyarr)
          cachelat = sidelat[sidelat.length-1]
          cachelon = sidelon[sidelon.length-1]
          console.log(cachelat,cachelon)
          // alert("switch off device's location and switch on again when reach the ending corner")
          markcoord.innerHTML = "STOP";
          
          
          var row = table.insertRow();
          var cell1 = row.insertCell(0);
          var cell2 = row.insertCell(1);
          cell1.innerHTML = sidelat[sidelat.length-1];
          cell2.innerHTML = sidelon[sidelon.length-1];
        }
        else if (markcoord.innerHTML == "STOP") {
          cachelat2 = sidelat[sidelat.length-1]
          cachelon2 = sidelon[sidelon.length-1]

          console.log(cachelat2,cachelon2)
          // ctx.lineTo(sidelat[sidelat.length-1]*20,sidelon[sidelon.length-1]*20)
  
          console.log("noofside",noofside)
          console.log("stop ",sidelat[noofside], sidelon[noofside])
          console.log("stop ",sidelat,sidelon)
          // alert("stop "+String(sidelat[noofside])+" "+String(sidelon[noofside]))


          

          var row = table.insertRow();
          var cell1 = row.insertCell(0);
          var cell2 = row.insertCell(1);
          cell1.innerHTML = sidelat[sidelat.length-1];
          cell2.innerHTML = sidelon[sidelon.length-1];

          
          let a = { latitude: cachelat, longitude: cachelon }
          let b = { latitude: cachelat2, longitude: cachelon2 }

          console.log(haversineDistance(a, b))
          alert("distance is "+String(haversineDistance(a, b))+" metres")
          markcoord.innerHTML = "START";

          distarr.push(haversineDistance(a,b))
          
          // ctx.translate((-sidelat[0]+7)-(trancount*(-sidelat[0]+7)),(-sidelon[0]+7)-(trancount*(-sidelon[0]+7)))
          // ctx.rect(sidelat[0],sidelon[0],50,50)
          // ctx.lineTo(sidelat[sidelat.length-1]*2,sidelon[sidelon.length-1]*2)
          trancount++
          // pixxdistarr.push(mod((sidelat[sidelat.length-1]-sidelat[sidelat.length-2])*50/mod((sidelat[1]-sidelat[0]))))
          // pixydistarr.push(mod((sidelon[sidelon.length-1]-sidelon[sidelon.length-2])*50/mod((sidelon[1]-sidelon[0]))))

          // pixxarr.push(pixxarr[pixxarr.length-1]+pixxdistarr[pixxdistarr.length-1])
          // pixyarr.push(pixyarr[pixyarr.length-1]+pixydistarr[pixydistarr.length-1])

          
          console.log("pixxarr",pixxarr)
          console.log("pixyarr",pixyarr)
          console.log("pixxdistarr",pixxdistarr)
          console.log("pixydistarr",pixydistarr)

          let xdiff = sidelat[1] - sidelat[0]
          let ydiff = sidelon[1] - sidelon[0] 

          console.log("xdiff",xdiff," ","ydiff",ydiff)

          if( noofside > 1 && sidelat[sidelat.length-1] == sidelat[0] && sidelon[sidelon.length-1] == sidelon[0]){
            //ctx.lineTo(7,(myCanvas.height/2)+30)
            // ctx.lineTo(7,7)
            // pixxarr.push(7)
            // pixyarr.push(7)
            console.log("shittt")
            ctx.lineTo(sidelat[0],sidelon[0])
          }
          else{
            ctx.lineTo(sidelat[sidelat.length-1]*12/xdiff,sidelon[sidelon.length-1]*12/ydiff)
            //  WORKING!!!
            // ctx.lineTo(sidelat[sidelat.length-1]*135/sidelat[0],sidelon[sidelon.length-1]*((myCanvas.height/2)+30)/sidelon[0])
            // ctx.lineTo(pixxarr[pixxarr.length-1],pixyarr[pixyarr.length-1])
          }

          if(noofside == 2){
          // ctx.rect((myCanvas.width/2)-distarr[0]*0.00005, (myCanvas.height/3), distarr[0]*0.00005, distarr[1]*0.00005);
          // ctx.rect((myCanvas.width/2)-distarr[0]*1.5, (myCanvas.height/3), distarr[0]*1.5, distarr[1]*1.5);
          // ctx.rect(60, 20, distarr[0]*3, distarr[1]*3);
          area = distarr[0]*distarr[1]
          enterarea.innerHTML = area
          ar.innerHTML = "Area:-"+" "+String(area)
          }
        }
        ctx.stroke()

        startcounter++
      })
      

      function solveeqn(a,b,c,d,e,f,xory){
    
    // for ax + by + c = 0
    //     dx + ey + f = 0

    let a1 = a*(d/a)
    let b1 = b*(d/a)
    let c1 = c*(d/a)
    let y = (f - c1)/(b1-e)
    let x = (-c-(b*y))/a
    
    if(xory == "x"){
        // console.log(x)
        return x
    }
    else{
    // console.log(y)
    return y
    }

    // LOGIC!!

    //a1x + b1y + c1 = 0
    //dx + ey + f
    //(b1-e)*y + (c1-f) =0
    //y = (f - c1)/(b1-e)
    
    //ax + by + c = 0
    //x = (-c-(b*y))/a
}
// console.log(solveeqnusingmult(5,4,-2,5,3,-1,"y"))

function slopeofline(x1,y1,x2,y2){
    
    let slope = (y2-y1)/(x2-x1)
    
    return slope
    
    // console.log(slope)
    
    }
    // slopeofline(2,2,1,1)
    
    function anglebetweentwolines(m1,m2){
    
    let angleoflines = mod((m2-m1)/(1+(m1*m2)))
    return angleoflines
    // console.log(angleoflines)
    }
    
    // anglebetweentwolines(2,1)
    // anglebetweentwolines(slopeofline(2,2,1,1),slopeofline(3,1,5,4))
    
    function mod(something){
        
        if(something < 0){
            return something*-1
        }
        else{
            return something
        }
    }

    function revmod(something){
        
        if(something > 0){
            return something*-1
        }
        else{
            return something
        }
    }

  //   function startup() {
  //   video = document.getElementById('video');
  //   canvas = document.getElementById('canvas');
  //   photo = document.getElementById('photo');
  //   startbutton = document.getElementById('startbutton');
  //   }

  //   navigator.mediaDevices
  // .getUserMedia({ video: true, audio: false })
  // .then((stream) => {
  //   video.srcObject = stream;
  //   video.play();
  // })
  // .catch((err) => {
  //   console.error(`An error occurred: ${err}`);
  // });

  const URL = "https://teachablemachine.withgoogle.com/models/cO36uER31/";

  let model, webcam, labelContainer, maxPredictions;

  let startbutton = document.getElementById("startbutton")
  let startbutton2 = document.getElementById("startbutton2")
  // startbutton2.style.display = "none"
  startbutton.addEventListener("click",async()=>{
    startbutton2.style.display = "block"
    startbutton.style.display = "none"
    

    const modelURL = URL + "model.json";
    const metadataURL = URL + "metadata.json";

    model = await tmImage.load(modelURL, metadataURL);
    maxPredictions = model.getTotalClasses();

    const flip = true; // whether to flip the webcam
        webcam = new tmImage.Webcam(300, 300, flip); // width, height, flip
        await webcam.setup({facingMode: "environment" }); // request access to the webcam
        await webcam.play();
        window.requestAnimationFrame(loop);

        document.getElementById("webcam-container").appendChild(webcam.canvas);
        labelContainer = document.getElementById("label-container");
        for (let i = 0; i < maxPredictions; i++) { // and class labels
            // labelContainer.appendChild(document.createElement("div"));
        }

        
          startbutton2.addEventListener("click",async ()=>{
            await webcam.pause();
            await predict();
            document.getElementById("webcam-container").style.display = "none"
            startbutton2.style.display = "none"
            
          })


  })

  async function loop() {
        webcam.update(); // update the webcam frame
        // await predict();
        window.requestAnimationFrame(loop);
    }

    let plantdiagnose = document.getElementById("plantdiagnose")
    
    let healthtext;
    let healthTextarea = document.getElementById("healthTextarea")
    async function predict() {
      let plantdiagnosevalue = plantdiagnose.value
      console.log(plantdiagnosevalue)
        // predict can take in an image, video or canvas html element
        const prediction = await model.predict(webcam.canvas);
        for (let i = 0; i < maxPredictions; i++) {
            const classPrediction =
            prediction[i].className + ": " + prediction[i].probability.toFixed(2);
            // labelContainer.childNodes[i].innerHTML = classPrediction;
            
            if(prediction[0].probability.toFixed(2) > prediction[1].probability.toFixed(2) && prediction[0].probability.toFixed(2) > prediction[2].probability.toFixed(2) && prediction[0].probability.toFixed(2) > prediction[3].probability.toFixed(2)){
            // console.log("0 big")
            // break;
            healthtext = "Is"+" "+String(plantdiagnosevalue)+" "+"plant with leaves having"+" "+String(prediction[0].className)+" "+"healthy, if not which disease does it have and how to treat it"
            
            
            }
            
            else if(prediction[1].probability.toFixed(2) > prediction[0].probability.toFixed(2) && prediction[1].probability.toFixed(2) > prediction[2].probability.toFixed(2) && prediction[1].probability.toFixed(2) > prediction[3].probability.toFixed(2)){
              console.log("1 big")
              // break;
              healthtext = "Is"+" "+String(plantdiagnosevalue)+" "+"plant with leaves having"+" "+String(prediction[1].className)+" "+"healthy, if not which disease does it have and how to treat it"
            }

            
            else if(prediction[2].probability.toFixed(2) > prediction[0].probability.toFixed(2) && prediction[2].probability.toFixed(2) > prediction[1].probability.toFixed(2) && prediction[2].probability.toFixed(2) > prediction[3].probability.toFixed(2)){
              console.log("2 big")
              // break;
              healthtext = "Is"+" "+String(plantdiagnosevalue)+" "+"plant with leaves having"+" "+String(prediction[2].className)+" "+"healthy, if not which disease does it have and how to treat it"
            }

            else{
              console.log("3 big")
              healthtext = "Is"+" "+String(plantdiagnosevalue)+" "+"plant with leaves having"+" "+String(prediction[3].className)+" "+"healthy, if not which disease does it have and how to treat it"
              // break;
            }

            if (healthtext) {
        try {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${API_KEY}`,
                },
                body: JSON.stringify({
                    model: 'gpt-4',
                    messages: [{ role: 'user', content: healthtext }],
                    temperature: 1.0,
                    top_p: 0.7,
                    n: 1,
                    stream: false,
                    presence_penalty: 0,
                    frequency_penalty: 0,
                }),
            });

            if (response.ok) {
                const data = await response.json();
                healthTextarea.value = data.choices[0].message.content;
                break;
            } else {
                healthTextarea.value = 'Error: Unable to process your request.';
            }
        } catch (error) {
            console.error(error);
            healthTextarea.value = 'Error: Unable to process your request.';
        }
    }


        }
    }

    </script>
  </body>
</html>
