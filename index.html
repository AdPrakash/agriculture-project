<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Agriculture App</title>
    
    <base href="/" />
    
    <meta name="color-scheme" content="light dark" />
    <meta
      name="viewport"
      content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    
    <link rel="manifest" href="/manifest.json" />
    
    <link rel="shortcut icon" type="image/png" href="/favicon.png" />
    
    <!-- add to homescreen for ios -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="Ionic App" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.css' rel='stylesheet' />
  </head>
  <body>
    
    <div id="marker"></div>
    <button id="closecam" autoplay>CLOSE</button>
    <video id="vid"></video>
    <div id="frstpgtitle" class="title">Your Location</div>
    <div id="scndpgtitle" class="title">Field details</div>
    <div class="page" id="zeropg">
      <div id="appicon"></div>
      <p id="appname">AgriBuddy</p>
    </div>
    <div class="page" id="firstpg">
      <textarea id="historytext" class="inputtop" cols="20" rows="2">Enter crops grown</textarea>
    </div>
    <div class="page" id="secondpg">
      <!-- <div id='map' style='width: 390px; height: 370px;'></div> -->
    </div>
    <div class="page" id="pagediff">

      <button id="nextdiff" class="inputmid">Next</button>
      <button id="previousdiff" class="inputmid">Previous</button>
      <div id="History">History</div>
      <!-- <textarea id="historytext" class="inputtop" cols="20" rows="2">Enter crops grown</textarea> -->
      <table id="tbldiff">
        <tr>
          <th>Crop</th>
          <th>Price per qt</th>
        </tr>
        <tr>
          <td id="c1"></td>
          <td id="p1"></td>
        </tr>
        <tr>
          <td id="c2"></td>
          <td id="p2"></td>
        </tr>
        <tr>
          <td id="c3"></td>
          <td id="p3"></td>
        </tr>
        <tr>
          <td id="c4"></td>
          <td id="p4"></td>
        </tr>
        <tr>
          <td id="c5"></td>
          <td id="p5"></td>
        </tr>
      </table>
      <button class="diffbut" id="select1">SELECT</button>
      <button class="diffbut" id="select2">SELECT</button>
      <button class="diffbut" id="select3">SELECT</button>
      <button class="diffbut" id="select4">SELECT</button>
      <button class="diffbut" id="select5">SELECT</button>
    </div>

    <div class="page" id="thirdpg">
      <button class="dashboardbut" id="overview">GPSdata</button>
      <button class="dashboardbut" id="detailed">Detailed</button>
      <button class="dashboardbut" id="diseasediag">Health</button>
      <button class="dashboardbut" id="budget">Budget</button>
      <textarea readonly id="responseTextarea" cols="40" rows="10"></textarea>
      <textarea readonly id="healthTextarea" cols="40" rows="10"></textarea>
      <textarea readonly id="budgetTextarea" cols="40" rows="10"></textarea>
      <textarea class="inputtop" id="plantdiagnose" cols="20" rows="2">Enter crop</textarea>
      <video id="video">Video Stream not available</video>
      <button id="startbutton2">Take photo</button>
      <button id="startbutton">Start Video</button>
      <div class="tile" id="soilprep">Land preparation<br><br>read more</div>
      <textarea readonly class="difftext" id="soilpreptext" cols="40" rows="10" class="difftext"></textarea>
      <div class="tile" id="sowing">Sowing<br><br>read more</div>
      <textarea readonly id="sowtext" class="difftext" cols="40" rows="10" class="difftext"></textarea>
      <div class="tile" id="irrigation">Irrigation and fertilisation<br><br>read more</div>
      <textarea readonly id="irrtext" class="difftext" cols="40" rows="10" class="difftext"></textarea>
      <div class="tile" id="harvesting">Harvesting<br><br>read more</div>
      <textarea readonly id="harvesttext" class="difftext" cols="40" rows="10"></textarea>
      <div id="slider"></div>
      <!-- <div class="tile" id="fertilisation">Harvesting<br><br>read more</div> -->
      <div id="webcam-container"></div>
      <div id="label-container"></div>
      <div id="loadingicon"></div>
      <p id="ar">Area</p>
      <table id="tbl">
        <tr>
          <th>Latitude</th>
          <th>Longitude</th>
        </tr>
      </table>
    </div>
    <div id="empty"></div>
    <div id="footer">Dashboard</div>
    <div id="root"></div>
    <textarea id="state" class="inputtop" cols="20" rows="2">Enter state</textarea>
    <textarea id="district" class="inputmid" cols="20" rows="2">Enter district</textarea>
    <textarea id="profilename" class="inputmid" cols="20" rows="2">Enter profile name</textarea>
    <textarea id="enterarea" class="inputtop" cols="20" rows="2">Enter area</textarea>
    

    <div id="or" class="inputmid" class="or">or</div>
    <div id="or2" class="inputmid" class="or">or</div>
    <button id="calarea" class="inputmid" autoplay>Map your field</button>
    <button id="getloc" class="inputmid">get location</button>
    <button id="markcoord">START</button>
    <button id="next" class="inputmid">Next</button>
    <!-- <button id="previous" class="inputmid">Previous</button> -->
    <button id="next2" class="inputmid">Next</button>
    <button id="previous2" class="inputmid">Previous</button>
    <div id="canvpreview">Preview:-</div>
    <canvas id="myCanvas"></canvas>
    <div id='map'></div>
    <div id="profileicon"></div>
    <div id="popup">
      <table id="tblpop">
        <tr>
          <th>Profile</th>
        </tr>
      </table>
      <button id="newbut">New profile</button>
    </div>
    
    
  <style>
    body{
      background-color: #00B277;
      font-family: Arial, Helvetica, sans-serif;
      scroll-snap-type: mandatory;
      overflow: hidden;
      /* color: white; */
    }

    .difftext{
      position: absolute;
      top: 16%;
      left: 4%;
      border-radius: 40px;
      width: 89%;
      background-color: white;
      color: black;
      height: 79%;
      z-index: +1;
      font-size: x-large;
      
    }

.tile{
  color: black;
}

    .diffbut{
      position: absolute;
      right: 5%;
      width: 20%;
      height: 5%;
      text-align: center;
      border-radius: 30px;
      background-color: #C1FF35;
    }

    #select1{
      position: absolute;
      top: 35%;
      color: black;
    }

    #select2{
      position: absolute;
      top: 40.5%;
      color: black;
    }

    #select3{
      position: absolute;
      top: 46%;
      color: black;
    }

    #select4{
      position: absolute;
      top: 51.5%;
      color: black;
    }

    #select5{
      position: absolute;
      top: 56.5%;
      color: black;
    }

    #tbldiff{
      position: absolute;
      top: 30%;
      left: 1%;
      font-size: x-large;
      color: black;
    }


    #soilprep {
      position: absolute;
      top: 15%;
      right: 3%;
      width: 80%;
      height: 15%;
      border-radius: 50px;
      background-color: rgb(191, 214, 172);
      text-align: center;
      padding-top: 5%;
      font-size: xx-large;
      
    }
    

    #sowing {
      position: absolute;
      top: 33%;
      right: 3%;
      width: 80%;
      height: 15%;
      border-radius: 50px;
      background-color: rgb(191, 214, 172);
      text-align: center;
      padding-top: 5%;
      font-size: xx-large;
      
    }

    #irrigation {
      position: absolute;
      top: 51%;
      right: 3%;
      width: 80%;
      height: 15%;
      border-radius: 50px;
      background-color: rgb(191, 214, 172);
      text-align: center;
      padding-top: 5%;
      font-size: x-large;
      
    }    
    #harvesting {
      position: absolute;
      top: 69%;
      right: 3%;
      width: 80%;
      height: 15%;
      border-radius: 50px;
      background-color: rgb(191, 214, 172);
      text-align: center;
      padding-top: 5%;
      font-size: xx-large;
      
    }

    #tile{
      right: 3%;
      width: 80%;
      height: 15%;
      border-radius: 50px;
      background-color: rgb(191, 214, 172);
      
    }

    #slider{
      position: absolute;
      top: 15%;
      left: 5%;
      width: 5%;
      height: 80%;
      background-color: #00B277;
      border-radius: 50px;
      z-index: -1;
    }

    #historytext{
      position: absolute;
      top: 61.3%;
      background-color: white;
      left: 5.5%;
      z-index: +1;
    }

    #History{
      position: absolute;
      top: 1%;
      left: 1%;
      font-size: xx-large;
    }

    #tblpop{
      position: relative;
      top: 10%;
      left: 5%;
      width: 60%;
      font-size: x-large;
      z-index: +1;
      color: black;
    }

    #map{
      position: absolute;
      top: 43%;
      width: 94%;
      aspect-ratio: 1/1;
      bottom: 7%;
      left: 103%;
      z-index: +1;
    }

    #startbutton{
      position: absolute;
      top: 80%;
      left: 35%;
      height: 6%;
      border-radius: 100%;
      font-weight: bold;
      background-color: yellowgreen;
      color: black;
      /* z-index: +2; */
    }

    #webcam-container{
      position: absolute;
      top: 30%;
      left: 10%;
    }

    #startbutton2{
      position: absolute;
      top: 80%;
      left: 35%;
      height: 6%;
      border-radius: 100%;
      font-weight: bold;
      background-color: yellowgreen;
      color: black;
      /* z-index: -1; */
    }

    #loadingicon{
      position: relative;
      top: -45%;
      left: 30%;
      background-color: black;
      background-image: url(https://www.shutterstock.com/image-vector/industrial-agricultural-icon-260nw-526588474.jpg);
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
      width: 150px;
      aspect-ratio: 1/1;
      border-radius: 70px;
      z-index: +100;
      /* animation-name: rot;
      animation-duration: 3s;
      animation-iteration-count: 5; */
    }

    @keyframes rot {
  0% {transform: rotate(0deg)}
  50% {transform: rotate(180deg)}
  100% {transform: rotate(360deg)}
}

    #ar{
      position: absolute;
      top: 65%;
      left: 30%;
      font-size: larger;
    }

    html{
      scroll-snap-type: mandatory;
      scroll-behavior: smooth;
    }

    #tbl{
      position: relative;
      top: 65%;
      width: 100%;
      text-align: center;
    }

    td, th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;
}

  #appicon{
      position: relative;
      top: 30%;
      left: 30%;
      width: 40%;
      aspect-ratio: 1/1;
      background-color: gainsboro;
      background-image: url(https://www.shutterstock.com/image-vector/industrial-agricultural-icon-260nw-526588474.jpg);
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
      border-radius: 100px;
    
  }

    #appname{
      position: relative;
      top: 30%;
      left: 29%;
      font-size: xx-large;
      /* font-family:'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif; */
    }

    #profileicon{
      position: absolute;
      top: 2%;
      left: 385%;
      width: 10%;
      aspect-ratio: 1/1;
      background-color: gainsboro;
      background-image: url(https://png.pngtree.com/png-clipart/20200224/original/pngtree-avatar-icon-profile-icon-member-login-vector-isolated-png-image_5247852.jpg);
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
      border-radius: 50px;
    }

    #popup{
      position: absolute;
      bottom: 0%;
      height: 60%;
      width: 100%;
      background-color: whitesmoke;
      border-radius: 2%;
      left: 300%;
      z-index: +2;
    }

    #newbut{
      position: relative;
      width: 25%;
      top: 65%;
      left: 37%;
      aspect-ratio: 2/1;
      background-color: yellowgreen;
      color: black;
      font-size: larger;
      border-radius: 30px;
    }

    #next {
      top: 70%;
      left: 53%;
      width: 30%;
      height: 5%;
      font-size: larger;
      border-radius: 20px;
      background-color: #C1FF35;
      z-index: +10;
    }

    #previous {
      top: 50%;
      left: 13%;
      width: 30%;
      height: 5%;
      font-size: larger;
      border-radius: 20px;
      background-color: yellowgreen;
      z-index: +10;
    }

    #next2 {
      top: 25%;
      left: 153%;
      width: 30%;
      height: 5%;
      font-size: larger;
      border-radius: 20px;
      background-color: yellowgreen;
      z-index: +1;
    }

    #nextdiff {
      top: 80%;
      left: 55%;
      width: 30%;
      height: 5%;
      font-size: larger;
      border-radius: 20px;
      background-color: yellowgreen;
      z-index: +1;
    }

    #previousdiff {
      top: 80%;
      right: 55%;
      width: 30%;
      height: 5%;
      font-size: larger;
      border-radius: 20px;
      background-color: yellowgreen;
      z-index: +1;
    }

    #previous2 {
      top: 25%;
      left: 113%;
      width: 30%;
      height: 5%;
      font-size: larger;
      border-radius: 20px;
      background-color: yellowgreen;
      z-index: +1;
    }

    .or{
      color: black;
      /* font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif; */
      border-radius: 0%;
      position: absolute;
      top: 30%;
      resize: none;
      font-size: xx-large;
      overflow: hidden;
      height: 4%;
    }

    video {
        position: absolute;
        left: 103%;
        top: 2%;
        width: 94%;
        height: 0%;
        object-fit: cover;
        z-index: +2;
        
    }

    #myCanvas{
      position: absolute;
      bottom: 7%;
      height: 50%;
      /*height: 500px;*/
      width: 94%;
      /*width: 500px;*/
      background-color: white;
      border-style: solid;
      border-width: 1px;
      left: 103%;
      display: none;
    }

    #closecam {
      position: absolute;
        left: 105%;
        bottom: 10%;
        width: 15%;
        aspect-ratio: 1/1;
        object-fit: cover;
        z-index: +3;
        border-radius: 100px;
        background-color: red;
        font-weight:800;
        /* display: hidden; */
    }

    #markcoord {
      position: absolute;
        left: 140%;
        bottom: 10%;
        width: 15%;
        aspect-ratio: 1/1;
        font-size: small;
        text-align: center;
        object-fit: cover;
        z-index: +3;
        border-radius: 100px;
        background-color: yellowgreen;
        /* display: hidden; */
    }

    #frstpgtitle{
           left: 4%;
           color: black;
           /* font-family: Arial, Helvetica, sans-serif; */
    }

    #scndpgtitle{
           left: 104%;
           width: 50%;
           color: black;

    }

    .title{
      font-size: xx-large;
      /* font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif; */
      position: absolute;
      top: 3%;
      z-index: +1;
    }

    #area{
      left: 108%;
    }

    #calarea{
      left: 123%;
      width: 50%;
      height: 5%;
      font-size: larger;
      border-radius: 20px;
      background-color: yellowgreen;
      top: 17%;
    }

    #or2{
      position: absolute;
      left: 110%;
      top: 17%;
      color: black;
      /* background-color: #00CF62; */
    }

    #or{
      position: absolute;
      /* background-color: #00CF62; */
      left: 10%;
      top: 30%;
      color: black;
    }

    #enterarea{
      left: 113%;
      top: 10%;
    }

    #plantdiagnose{
      position: relative;
      left: 8%;
      top: 8%;
      /* display: none; */
    }

    #canvpreview{
      position: absolute;
      left: 103%;
      top: 39%;
      font-size: xx-large;
    }
    
    #getloc{
      left: 28%;
      width: 40%;
      height: 5%;
      font-size: larger;
      border-radius: 20px;
      background-color: #C1FF35;
    }

    #prvcrops{
      top: 40%;
      left: 108%;
    }

    .inputtop{
      background-color: white;
      position: absolute;
      top: 20%;
      resize: none;
      font-size: xx-large;
      overflow: hidden;
      height: 4%;
      border-radius: 30px;
      color: black;
    }

    .inputmid{
      background-color: white;
      position: absolute;
      top: 30%;
      resize: none;
      font-size: xx-large;
      overflow: hidden;
      height: 4%;
      border-radius: 30px;
      color: black;
    }

    #responseTextarea{
      position: absolute;
      bottom: -100%;
      left: 0%;
      height: 85%;
      width: 99%;
      font-size: xx-large;
      resize: none;
      color: black;
      background-color: white;
      z-index: +1;
      display: hidden;
    }

    #healthTextarea{
      position: absolute;
      top: 20%;
      left: 0%;
      height: 80%;
      width: 99%;
      font-size: xx-large;
      resize: none;
      color: black;
      background-color: white;
      /* z-index: -1; */
      /* display: none; */
    }

    #budgetTextarea{
      position: absolute;
      top: 20%;
      left: 0%;
      height: 80%;
      width: 99%;
      font-size: xx-large;
      resize: none;
      color: black;
      background-color: white;
      /* z-index: -1; */
      /* display: none; */
    }

    #profilename{
      left: 8%;
      top: 60%;
      background-color: #00CF62;
      border-color: white;
      border-width: 2px;
      color: white;
    }

    #state{
      left: 8%;
      /* background-color: #00CF62; */
      /* border-color: white; */
      /* border-width: 2px; */
      /* color: white; */

    }

    #district{
      left: 8%;
      top: 40%;
      /* background-color: #00CF62; */
      /* border-color: white; */
      /* border-width: 2px; */
      /* color: white; */
    }

    #empty{
      position: absolute;
      left: 0%;
      bottom: 0%;
      width: 300%;
      height: 1px;
    }

    #footer{
      position: absolute;
      top: 0%;
      left: 300%;
      width: 100%;
      height: 6%;
      background-color: green;
      color: white;
      font-size: xx-large;
      text-align: left;
      padding-top: 4%;
      padding-left: 3%;
    }

    #zeropg{
      left: -100%;
      z-index: +15;
    }

    #firstpg {
      left: 3%;
    }

    #secondpg {
      left: 103%;
    }

    #thirdpg {
      left: 303%;
    }

    #pagediff {
      left: 203%;
    }

    .dashboardbut{
      position: relative;
      width: 23%;
      aspect-ratio: 2/1;
      top: 7%;
      left: 1%;
      border-radius: 40px;
      background-color: white;
      font-size: larger;
      text-align: center;
      border-style: solid;
      color: black;
      
    }

    

    .page{
      position: absolute;
      top: 2%;
      height: 95%;
      width: 94%;
      background-color: white;
      border-radius: 2%;
      scroll-snap-align: center;

    }
  </style>
    <script type="module" src="/src/main.tsx"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/haversine-distance@1.2.1/index.min.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.js'></script>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
<script type="module">

import API_KEY from "/apikey.js"
import API_KEYM from "/apikeym.js"

const asin = Math.asin
const cos = Math.cos
const sin = Math.sin
const sqrt = Math.sqrt
const PI = Math.PI

// equatorial mean radius of Earth (in meters)
const R = 6378137

function squared (x) { return x * x }
function toRad (x) { return x * PI / 180.0 }
function hav (x) {
  return squared(sin(x / 2))
}

// hav(theta) = hav(bLat - aLat) + cos(aLat) * cos(bLat) * hav(bLon - aLon)
function haversineDistance (a, b) {
  const aLat = toRad(Array.isArray(a) ? a[1] : a.latitude || a.lat)
  const bLat = toRad(Array.isArray(b) ? b[1] : b.latitude || b.lat)
  const aLng = toRad(Array.isArray(a) ? a[0] : a.longitude || a.lng || a.lon)
  const bLng = toRad(Array.isArray(b) ? b[0] : b.longitude || b.lng || b.lon)

  const ht = hav(bLat - aLat) + cos(aLat) * cos(bLat) * hav(bLng - aLng)
  return 2 * R * asin(sqrt(ht))
}

let profilename = document.getElementById("profilename")
let state = document.getElementById("state")
let getloc = document.getElementById("getloc")
let district = document.getElementById("district")
let calarea = document.getElementById("calarea")
let closecam = document.getElementById("closecam")
let markcoord = document.getElementById("markcoord")
let sidelat = []
let sidelon = []
let noofside = 0
// let marker = document.getElementById("marker")
let myCanvas = document.getElementById("myCanvas")
var ctx = myCanvas.getContext("2d");
var startcounter = 0
let geodist

let xposend = Math.floor(sidelat[noofside])
let yposend = Math.floor(sidelon[noofside])
let xpos = Math.floor(sidelat[noofside-1])
let ypos = Math.floor(sidelon[noofside-1])
let debx = 19.075984
let deby = 72.877656
let debxend = 28.6097408
let debyend = 77.3685248
let nextcounter = 0
let scrolltarget = screen.width
let next = document.getElementById("next")
let previous2 = document.getElementById("previous2")
let next2 = document.getElementById("next2")
let id;
let cachelat;
let cachelon;
let cachelat2;
let cachelon2;
let delcachelat = cachelat2-cachelat;
let delcachelon = cachelon2-cachelon;
let popup = document.getElementById("popup")
let profileicon = document.getElementById("profileicon")
let newbut = document.getElementById('newbut')
let popupcount = 1;
let maxX;
let maxY;
let cachesidelat = []
let cachesidelon = []
let hope;
let responseTextarea = document.getElementById("responseTextarea")
let canvpreview = document.getElementById("canvpreview")
let permstate;
let permarea;
let headarr = []
let distarr = []
let area;
let overview = document.getElementById("overview")
let detailed = document.getElementById("detailed")
let health = document.getElementById("diseasediag")
var table = document.getElementById("tbl");
let ar = document.getElementById("ar")
let loadingicon = document.getElementById("loadingicon")
let enterarea = document.getElementById("enterarea")
let magnification;
let slopearr = []
let x1;
let y1;
let pixxarr = []
let pixyarr =[]
let pixxdistarr = []
let pixydistarr = []
let magx;
let magy;
let trancount = 0;
let tblpop = document.getElementById("tblpop")
let actlatloncomb = []
let mp = document.getElementById("map")
let startbutton = document.getElementById("startbutton")
let startbutton2 = document.getElementById("startbutton2")
let healthTextarea = document.getElementById("healthTextarea")
let plantdiagnose = document.getElementById("plantdiagnose")
let getloccount = 0
let nextdiff = document.getElementById("nextdiff")
let previousdiff = document.getElementById("previousdiff")
let historytext = document.getElementById("historytext")
let budget = document.getElementById("budget")
let chosencrop
let soilprep = document.getElementById("soilprep")
let sowing = document.getElementById("sowing")
let irrigation = document.getElementById("irrigation")
let harvesting = document.getElementById("harvesting")
let tbldiff = document.getElementById("tbldiff")
let soilcount = 0
let sowcount = 0
let irrcount = 0
let harcount = 0
let haryana = ["Banana","Ber","Carrot","Coriander","Garlic","Ginger","Grapes","Green Chilli","Kinnow","Leafy Vegetable","Methi","Peas","Potato","Raddish","Spinach","Apple","Cabbage","Carrot","Cauliflower","Grapes","Green Chilli","Sugarcane","Orange","ChickPeas","Pomegranate","Potato","Raddish","Tomato","Banana","Bottle gourd","Cabbage","Carrot","Cauliflower","Cucumbar","Grapes","Onion","Orange","Papaya","Pomegranate","Potato","Raddish","Spinach","Mustard","Tomato","Potato","Apple","Banana","Ber","Bhindi","Carrot","Maize","Cucumbar","Ginger","Grapes","Maize","Orange","Pomegranate","Potato","Raddish","Tomato","Cauliflower","Onion","Potato","Tomato","Wheat"]

let haryanaprice = [3000,3000,700,1805,3000,8000,4000,5000,1500,1000,1410,1200,325,600,715,5000,450,450,2000,4000,2900,1250,2000,900,4500,550,900,1750,3000,2700,550,400,1450,1400,3500,1000,2200,1650,1500,4250,650,750,750,1550,1500,296,8000,2000,1300,6000,700,3500,3000,9000,3000,1500,3000,5000,700,800,1500,800,1500,1000,1500,2320]

let c1 = document.getElementById("c1")
let c2 = document.getElementById("c2")
let c3 = document.getElementById("c3")
let c4 = document.getElementById("c4")
let c5 = document.getElementById("c5")
let p1 = document.getElementById("p1")
let p2 = document.getElementById("p2")
let p3 = document.getElementById("p3")
let p4 = document.getElementById("p4")
let p5 = document.getElementById("p5")
let soilpreptext = document.getElementById("soilpreptext")
let sowtext = document.getElementById("sowtext")
let irrtext = document.getElementById("irrtext")
let harvesttext = document.getElementById("harvesttext")
let difftext = document.getElementsByClassName("difftext")
let select1 = document.getElementById("select1")
let select2 = document.getElementById("select2")
let select3 = document.getElementById("select3")
let select4 = document.getElementById("select4")
let select5 = document.getElementById("select5")
let actcrop = ""
let actprice = ""
let budgetTextarea = document.getElementById("budgetTextarea")

budgetTextarea.style.display="none"

select1.addEventListener("click",()=>{
  actcrop = actcrop+" "+c1.innerHTML
  actprice = actprice+","+String(p1.innerHTML)
  console.log(actcrop)
})
select2.addEventListener("click",()=>{
  actcrop = actcrop+" "+c2.innerHTML
  actprice = actprice+","+String(p2.innerHTML)
  console.log(actcrop)
})
select3.addEventListener("click",()=>{
  actcrop = actcrop+" "+c3.innerHTML
  actprice = actprice+","+String(p3.innerHTML)
  console.log(actcrop)
})
select4.addEventListener("click",()=>{
  actcrop = actcrop+" "+c4.innerHTML
  actprice = actprice+","+String(p4.innerHTML)
  console.log(actcrop)
})
select5.addEventListener("click",()=>{
  actprice = actprice+","+String(p5.innerHTML)
  actcrop = actcrop+" "+c5.innerHTML
  console.log(actcrop)
})

healthTextarea.style.display="none"
table.style.display="none"

soilpreptext.addEventListener("click",()=>{
  soilpreptext.style.display = "none"
  soilprep.style.height = "15%"
    soilprep.style.width = "80%"
    soilprep.innerHTML = "Land Preparation<br><br>read more"
    sowing.style.display = "block"
  irrigation.style.display = "block"
  harvesting.style.display = "block"
  soilpreptext.style.display = "none"
})

sowtext.addEventListener("click",()=>{
  sowtext.style.display = "none"
  sowing.style.top = "33%"
    sowing.style.height = "15%"
    sowing.style.width = "80%"
    sowing.innerHTML = "Sowing<br><br>read more"
    soilprep.style.display = "block"
  irrigation.style.display = "block"
  harvesting.style.display = "block"
})

irrtext.addEventListener("click",()=>{
  irrtext.style.display="none"
  irrigation.style.top = "51%"
    irrigation.style.height = "15%"
    irrigation.style.width = "80%"
    irrigation.innerHTML = "Irrigation and fertilisation<br><br>read more"
    sowing.style.display = "block"
  soilprep.style.display = "block"
  harvesting.style.display = "block"
})

harvesttext.addEventListener('click',()=>{
  harvesttext.style.display = "none"
  harvesting.style.top = "69%"
    harvesting.style.height = "15%"
    harvesting.style.width = "80%"
    harvesting.innerHTML = "Harvesting<br><br>read more"
    sowing.style.display = "block"
  irrigation.style.display = "block"
  soilprep.style.display = "block"
})

soilpreptext.style.display = "none"
sowtext.style.display = "none"
irrtext.style.display = "none"
harvesttext.style.display = "none"

soilprep.addEventListener("click",()=>{
  
  soilcount++
  soilprep.style.width = "95%"
  soilprep.style.height = "80%"
  soilprep.style.top = "15%"
  sowing.style.display = "none"
  irrigation.style.display = "none"
  harvesting.style.display = "none"
  soilprep.innerHTML = ""
  soilpreptext.style.display = "block"
  if(soilcount%2==0){
    soilprep.style.height = "15%"
    soilprep.style.width = "80%"
    soilprep.innerHTML = "Land Preparation<br><br>read more"
    sowing.style.display = "block"
  irrigation.style.display = "block"
  harvesting.style.display = "block"
  soilpreptext.style.display = "none"
  }
  
})


sowing.addEventListener("click",async()=>{
  sowcount++
  sowing.style.width = "95%"
  sowing.style.top = "15%"
  sowing.style.height = "80%"
  soilprep.style.display = "none"
  irrigation.style.display = "none"
  harvesting.style.display = "none"
  sowtext.style.display = "block"
  if(sowcount%2==0){
    sowing.style.top = "33%"
    sowing.style.height = "15%"
    sowing.style.width = "80%"
    sowing.innerHTML = "Sowing<br><br>read more"
    soilprep.style.display = "block"
  irrigation.style.display = "block"
  harvesting.style.display = "block"
  }

  let mytext = "Instructions to sow"+" "+String(actcrop)+" "+"seeds in a"+" "+String(permarea)+" "+"metre square field in"+" "+permstate+" "+ "for the upcoming sowing season";

 if (mytext) {
        try {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${API_KEY}`,
                },
                body: JSON.stringify({
                    model: 'gpt-4',
                    messages: [{ role: 'user', content: mytext }],
                    temperature: 1.0,
                    top_p: 0.7,
                    n: 1,
                    stream: false,
                    presence_penalty: 0,
                    frequency_penalty: 0,
                }),
            });

            if (response.ok) {
                const data = await response.json();
                sowtext.value = data.choices[0].message.content;
               
            } else {
                responseTextarea.value = 'Error: Unable to process your request.';
            }
        } catch (error) {
            console.error(error);
            responseTextarea.value = 'Error: Unable to process your request.';
        }
    }
})


irrigation.addEventListener("click",async()=>{
  irrcount++
  irrigation.style.width = "95%"
  irrigation.style.height = "80%"
  irrigation.style.top = "15%"
  sowing.style.display = "none"
  soilprep.style.display = "none"
  harvesting.style.display = "none"
  irrtext.style.display = "block"
  if(irrcount%2==0){
    irrigation.style.top = "51%"
    irrigation.style.height = "15%"
    irrigation.style.width = "80%"
    irrigation.innerHTML = "Irrigation and fertilisation<br><br>read more"
    sowing.style.display = "block"
  soilprep.style.display = "block"
  harvesting.style.display = "block"
  }

  let mytext = "Instructions to irrigate a"+" "+String(permarea)+" "+"metre square field in"+" "+permstate+" "+ "for the upcoming sowing season to grow"+" "+String(actcrop);

 if (mytext) {
        try {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${API_KEY}`,
                },
                body: JSON.stringify({
                    model: 'gpt-4',
                    messages: [{ role: 'user', content: mytext }],
                    temperature: 1.0,
                    top_p: 0.7,
                    n: 1,
                    stream: false,
                    presence_penalty: 0,
                    frequency_penalty: 0,
                }),
            });

            if (response.ok) {
                const data = await response.json();
                irrtext.value = data.choices[0].message.content;
               
            } else {
                responseTextarea.value = 'Error: Unable to process your request.';
            }
        } catch (error) {
            console.error(error);
            responseTextarea.value = 'Error: Unable to process your request.';
        }
    }
})


harvesting.addEventListener("click",async()=>{
  harcount++
  harvesting.style.width = "95%"
  harvesting.style.height = "80%"
  harvesting.style.top = "15%"
  sowing.style.display = "none"
  irrigation.style.display = "none"
  soilprep.style.display = "none"
  harvesttext.style.display = "block"
  if(harcount%2==0){
    harvesting.style.top = "69%"
    harvesting.style.height = "15%"
    harvesting.style.width = "80%"
    harvesting.innerHTML = "Harvesting<br><br>read more"
    sowing.style.display = "block"
  irrigation.style.display = "block"
  soilprep.style.display = "block"
  }

  let mytext = "Instructions to harvest"+" "+String(actcrop)+" "+"seeds on"+" "+String(permarea)+" "+"metre square field in"+" "+permstate+" "+ "for the upcoming sowing season";

 if (mytext) {
        try {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${API_KEY}`,
                },
                body: JSON.stringify({
                    model: 'gpt-4',
                    messages: [{ role: 'user', content: mytext }],
                    temperature: 1.0,
                    top_p: 0.7,
                    n: 1,
                    stream: false,
                    presence_penalty: 0,
                    frequency_penalty: 0,
                }),
            });

            if (response.ok) {
                const data = await response.json();
                harvesttext.value = data.choices[0].message.content;
               
            } else {
                responseTextarea.value = 'Error: Unable to process your request.';
            }
        } catch (error) {
            console.error(error);
            responseTextarea.value = 'Error: Unable to process your request.';
        }
    }
})


calarea.disabled = true
overview.disabled = true         


loadingicon.style.display = "none"
ar.style.display = "none"

plantdiagnose.style.display = "none"

detailed.addEventListener("click",()=>{
  detailed.style.border = "medium solid #00b600"
  overview.style.border = "thin solid #000000"
  health.style.border = "thin solid #000000"
  mp.style.display = "none"
  // responseTextarea.style.display = "block"
  ar.style.display = "none"
  healthTextarea.style.display = "none"
  startbutton.style.display = "none"
  startbutton2.style.display = "none"
  plantdiagnose.style.display = "none"
  sowing.style.display="block"
  irrigation.style.display="block"
  soilprep.style.display="block"
  harvesting.style.display="block"
  budgetTextarea.style.display="none"
  budget.style.border = "thin solid #000000"
})

overview.addEventListener("click",()=>{
  overview.style.border = "medium solid #00b600"
  detailed.style.border = "thin solid #000000"
  health.style.border = "thin solid #000000"
  budgetTextarea.style.display="none"
  if(getloccount == 0){
    alert("Click the get location button on the first page to avail the feature")
  }

  ar.style.display = "block"
  mp.style.left = "303%"
  mp.style.top = "15%"
  mp.style.display = "block"
  responseTextarea.style.display = "none"
  healthTextarea.style.display = "none"
  startbutton.style.display = "none"
  startbutton2.style.display = "none"
  plantdiagnose.style.display = "none"
  sowing.style.display="none"
  irrigation.style.display="none"
  soilprep.style.display="none"
  harvesting.style.display="none"
  budget.style.border = "thin solid #000000"
})

health.addEventListener("click",()=>{
  health.style.border = "medium solid #00b600"
  detailed.style.border = "thin solid #000000"
  overview.style.border = "thin solid #000000"
  budget.style.border = "thin solid #000000"
  mp.style.display = "none"
  responseTextarea.style.display = "none"
  ar.style.display = "none"
  table.style.display = "none"
  healthTextarea.style.display = "block"
  startbutton.style.display = "block"
  startbutton2.style.display = "block"
  plantdiagnose.style.display = "block"
  sowing.style.display="none"
  irrigation.style.display="none"
  soilprep.style.display="none"
  harvesting.style.display="none"
  budgetTextarea.style.display="none"
})

budget.addEventListener("click",async()=>{
  budget.style.border = "medium solid #00b600"
  health.style.border = detailed.style.border = overview.style.border = "thin solid #000000"
  sowing.style.display="none"
  irrigation.style.display="none"
  soilprep.style.display="none"
  harvesting.style.display="none"
  healthTextarea.style.display="none"
  startbutton.style.display="none"
  startbutton2.style.display="none"
  plantdiagnose.style.display="none"
  budgetTextarea.style.display="block"

  let mytext = "Prepare an overall budget scheme among various tools,seeds,fertilizers and pesticides of"+" "+String(permarea)+" "+"metre square field in"+" "+permstate+" "+ "for the upcoming sowing season to grow"+" "+String(actcrop)+"whose budgets are"+" "+String(actprice)+" "+"per quintal";

  if (mytext) {
        try {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${API_KEY}`,
                },
                body: JSON.stringify({
                    model: 'gpt-4',
                    messages: [{ role: 'user', content: mytext }],
                    temperature: 1.0,
                    top_p: 0.7,
                    n: 1,
                    stream: false,
                    presence_penalty: 0,
                    frequency_penalty: 0,
                }),
            });

            if (response.ok) {
                const data = await response.json();
                budgetTextarea.value = data.choices[0].message.content;
               
            } else {
                responseTextarea.value = 'Error: Unable to process your request.';
            }
        } catch (error) {
            console.error(error);
            responseTextarea.value = 'Error: Unable to process your request.';
        }
    }
})

canvpreview.style.display = "none"
popup.style.display = "none"

newbut.addEventListener("click",()=>{
  popup.style.display = "none"
  window.scrollTo(0,0)
  nextcounter=0
  scrolltarget = screen.width
})

profileicon.addEventListener("click",()=>{
  popupcount++
  if(popupcount%2==0){
    popup.style.display = "block"
}
else{
    popup.style.display = "none"
}
})

state.addEventListener("click",()=>{
  if(getloccount == 0){
  state.innerHTML = ""
  }
})

district.addEventListener("click",()=>{
  if(getloccount == 0){
  district.innerHTML = ""
  }
})

profilename.addEventListener("click",()=>{
  profilename.innerHTML = ""
})

historytext.addEventListener("click",()=>{
  historytext.innerHTML = ""
})

enterarea.addEventListener("click",()=>{
  enterarea.innerHTML = ""
})

nextdiff.addEventListener("click", async(e)=>{
  window.scrollTo(scrolltarget,0)
  scrolltarget += screen.width
  nextcounter+=1
  e.preventDefault();

  let mytext = "How to prepare a"+" "+String(permarea)+" "+"metre square field in"+" "+permstate+" "+ "for the upcoming sowing season to grow"+" "+String(actcrop);

 if (mytext) {
        try {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${API_KEY}`,
                },
                body: JSON.stringify({
                    model: 'gpt-4',
                    messages: [{ role: 'user', content: mytext }],
                    temperature: 1.0,
                    top_p: 0.7,
                    n: 1,
                    stream: false,
                    presence_penalty: 0,
                    frequency_penalty: 0,
                }),
            });

            if (response.ok) {
                const data = await response.json();
                soilpreptext.value = data.choices[0].message.content;
               
            } else {
                responseTextarea.value = 'Error: Unable to process your request.';
            }
        } catch (error) {
            console.error(error);
            responseTextarea.value = 'Error: Unable to process your request.';
        }
    }


  
})

next.addEventListener("click",()=>{

  var rowpop = tblpop.insertRow();
          var cell1pop = rowpop.insertCell(0);
          cell1pop.innerHTML = profilename.value

window.scrollTo(scrolltarget,0)
scrolltarget += screen.width
nextcounter+=1
console.log(nextcounter)
localStorage.setItem("state", state.value);
localStorage.setItem("district", district.value);
})

next2.addEventListener("click", async (e)=>{
localStorage.setItem("area",enterarea.value)
e.preventDefault();


window.scrollTo(scrolltarget,0)
scrolltarget += screen.width
nextcounter+=1
console.log(nextcounter)
permstate = localStorage.getItem("state");
permarea = localStorage.getItem("area")
// let mytext = "Give me an yearly planner for sowing crops in a"+" "+String(permarea)+" "+"metre square field in"+" "+permstate+" "+ "along with budget division in percentage along with rupees among tools and crop seed price heading wise in detail";

let mytext = "Suggest me names of 5 crops most profitable to sow in"+" "+String(permarea)+" "+"metre square field in"+" "+permstate+" "+ " the upcoming sowing season based on the previous crops sown being"+" "+historytext.value+""+"just give the names seperated by commas";

 if (mytext) {
        try {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${API_KEY}`,
                },
                body: JSON.stringify({
                    model: 'gpt-4',
                    messages: [{ role: 'user', content: mytext }],
                    temperature: 1.0,
                    top_p: 0.7,
                    n: 1,
                    stream: false,
                    presence_penalty: 0,
                    frequency_penalty: 0,
                }),
            });

            if (response.ok) {
                const data = await response.json();
                chosencrop = data.choices[0].message.content;
                let myarr = chosencrop.split(", ")
                c1.innerHTML = myarr[0]
                c2.innerHTML = myarr[1]
                c3.innerHTML = myarr[2]
                c4.innerHTML = myarr[3]
                c5.innerHTML = myarr[4]

                for(let i=0;i<=haryana.length;i++){
                  if(haryana[i]==myarr[0]){
                    p1.innerHTML = haryanaprice[i]
                    // console.log(haryana[i])
                  }
                    else if(haryana[i]==myarr[1]){
                    p2.innerHTML = haryanaprice[i]
                  }
                  else if(haryana[i]==myarr[2]){
                    p3.innerHTML = haryanaprice[i]
                  }
                  else if(haryana[i]==myarr[3]){
                    p3.innerHTML = haryanaprice[i]
                  }
                  else if(haryana[i]==myarr[4]){
                    p4.innerHTML = haryanaprice[i]
                  }
                  else if(haryana[i]==myarr[5]){
                    p5.innerHTML = haryanaprice[i]
                  } 
                }
                
                


                console.log(myarr)
            } else {
                responseTextarea.value = 'Error: Unable to process your request.';
            }
        } catch (error) {
            console.error(error);
            responseTextarea.value = 'Error: Unable to process your request.';
        }
    }

})

previous2.addEventListener("click",()=>{

window.scrollTo(-scrolltarget,0)
scrolltarget -= screen.width
if(nextcounter > 0){
nextcounter-=1
}
console.log(nextcounter)
})

previousdiff.addEventListener("click",()=>{
  window.scrollTo(-scrolltarget,0)
scrolltarget -= screen.width
if(nextcounter > 0){
nextcounter-=1
} 
})

myCanvas.style.display = "none"
// marker.style.display = "none"
closecam.style.display = "none"
markcoord.style.display = "none"
getloc.addEventListener("click",() => {
    getloccount++
    calarea.disabled = false
    overview.disabled = false
 
    console.log("getloccount",getloccount)

    if(navigator.geolocation){
      navigator.geolocation.watchPosition(showLocation)
    }
    else{
      console.log("some issue was present")
    }
})

const showLocation = async (position) => {

          sidelat.push(position.coords.latitude)
          sidelon.push(position.coords.longitude)
          headarr.push(position.coords.heading)

  //We user the NOminatim API for getting actual addres from latitude and longitude
   let response = await fetch(
     `https://nominatim.openstreetmap.org/reverse?lat=${position.coords.latitude}&lon=${position.coords.longitude}&format=json`
  );
  //store response object
  let data = await response.json();
  state.innerHTML = data.address.state
  district.innerHTML = data.address.state_district
  console.log(data.address)
  
};

function options (){
        enableHighAccuracy: true
        maximumAge: 1000;
        }

function error(err) {
        console.error(`ERROR(${err.code}): ${err.message}`);
        }

        
    
        calarea.addEventListener("click", () => {
          
          
  if(getloccount == 0){
    alert("Click the get location button on the first page to avail the feature")
  }
          
          
          myCanvas.style.display = "none"
          // marker.style.display = "block"
          closecam.style.display = "block"
          markcoord.style.display = "block"
          canvpreview.style.display = "block"
        })
        let avglon=0;
        let avglat=0
        closecam.addEventListener("click",()=>{
          for(let i = 0; i < actlatloncomb.length; i++){
            avglon = (avglon+actlatloncomb[i][0])
            avglat = (avglat+actlatloncomb[i][1])

          }
          console.log("avglon",avglon/actlatloncomb.length)
          console.log("avglat",avglat/actlatloncomb.length)

          closecam.style.display = "none"
          markcoord.style.display = "none"
          localStorage.setItem("area",enterarea.innerHTML)
          // marker.style.display = "none"
          // navigator.geolocation.clearWatch(id);
          // mapboxgl.accessToken = 'pk.eyJ1IjoiYWRpdHlhMTIzNDU2Nzg5IiwiYSI6ImNscTEzZW0xbTA0cmkybG12MzI2NTR3YnIifQ.9DLVYlrOAC79qUVNqM832g';
          mapboxgl.accessToken = API_KEYM;
  let map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v11',
    center: [avglon/actlatloncomb.length, avglat/actlatloncomb.length],
    zoom: 17
  });
  map.on('load', () => {
map.addSource('route', {
'type': 'geojson',
'data': {
'type': 'Feature',
'properties': {},
'geometry': {
'type': 'LineString',
'coordinates': actlatloncomb
}
}
});
map.addLayer({
'id': 'route',
'type': 'line',
'source': 'route',
'layout': {
'line-join': 'round',
'line-cap': 'round'
},
'paint': {
'line-color': '#888',
'line-width': 8
}
});
});
        })

        ctx.lineWidth = "2"
          ctx.strokeStyle = "black"
          ctx.beginPath()
          // ctx.moveTo(7,(myCanvas.height/2)+30)
          // console.log("sidelat",sidelat[0]," ","sidelon",sidelon[0])
          // ctx.moveTo(sidelat[0],sidelon[0])
          markcoord.addEventListener("click",()=>{
          let xcan1;
          let ycan1;
          // ctx.lineWidth = "2"
          // ctx.strokeStyle = "black"
          // ctx.beginPath()
          // ctx.moveTo(7,(myCanvas.height/2)+30)
          
        if(markcoord.innerHTML == "START"){
          noofside++
          // console.log("noofside",noofside)
          if(noofside == 1){
            xcan1 = 7
            ycan1 = (myCanvas.height/2)+30
            pixxarr.push(7)
            // pixyarr.push((myCanvas.height/2)+30)
            pixyarr.push(7)
            ctx.translate((-sidelat[0]+7)-(trancount*(-sidelat[0]+7)),(-sidelon[0]+7)-(trancount*(-sidelon[0]+7)))
            ctx.moveTo(sidelat[0],sidelon[0])
          }
          else{
            xcan1 = sidelat[sidelat.length-1]
            ycan1 = sidelon[sidelon.length-1]
          }
          
          // ctx.moveTo(debx,deby)
          // 
          
          console.log("pixxarr",pixxarr)
          console.log("pixyarr",pixyarr)
          cachelat = sidelat[sidelat.length-1]
          cachelon = sidelon[sidelon.length-1]
          console.log(cachelat,cachelon)
          let latloncomb = [cachelon,cachelat]
          actlatloncomb.push(latloncomb)
          console.log("actlatloncomb",actlatloncomb)
          
          // for(let i = 0; i < actlatloncomb.length; i++){
          //   console.log("actlon",actlatloncomb[i][0])
          // }

          // mapboxgl.accessToken = 'pk.eyJ1IjoiYWRpdHlhMTIzNDU2Nzg5IiwiYSI6ImNscTEzZW0xbTA0cmkybG12MzI2NTR3YnIifQ.9DLVYlrOAC79qUVNqM832g';
          mapboxgl.accessToken = API_KEYM;
  let map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v11',
    center: [cachelon, cachelat],
    zoom: 17
  });
  map.on('load', () => {
map.addSource('route', {
'type': 'geojson',
'data': {
'type': 'Feature',
'properties': {},
'geometry': {
'type': 'LineString',
'coordinates': actlatloncomb
}
}
});
map.addLayer({
'id': 'route',
'type': 'line',
'source': 'route',
'layout': {
'line-join': 'round',
'line-cap': 'round'
},
'paint': {
'line-color': '#888',
'line-width': 8
}
});
});
          // alert("switch off device's location and switch on again when reach the ending corner")
          markcoord.innerHTML = "STOP";
          
          
          var row = table.insertRow();
          var cell1 = row.insertCell(0);
          var cell2 = row.insertCell(1);
          cell1.innerHTML = sidelat[sidelat.length-1];
          cell2.innerHTML = sidelon[sidelon.length-1];
        }
        else if (markcoord.innerHTML == "STOP") {
          cachelat2 = sidelat[sidelat.length-1]
          cachelon2 = sidelon[sidelon.length-1]

          console.log(cachelat2,cachelon2)
          // ctx.lineTo(sidelat[sidelat.length-1]*20,sidelon[sidelon.length-1]*20)
  
          console.log("noofside",noofside)
          console.log("stop ",sidelat[noofside], sidelon[noofside])
          console.log("stop ",sidelat,sidelon)
          // alert("stop "+String(sidelat[noofside])+" "+String(sidelon[noofside]))


          

          var row = table.insertRow();
          var cell1 = row.insertCell(0);
          var cell2 = row.insertCell(1);
          cell1.innerHTML = sidelat[sidelat.length-1];
          cell2.innerHTML = sidelon[sidelon.length-1];

          
          let a = { latitude: cachelat, longitude: cachelon }
          let b = { latitude: cachelat2, longitude: cachelon2 }

          console.log(haversineDistance(a, b))
          alert("distance is "+String(haversineDistance(a, b))+" metres")
          markcoord.innerHTML = "START";

          distarr.push(haversineDistance(a,b))
          
          // ctx.translate((-sidelat[0]+7)-(trancount*(-sidelat[0]+7)),(-sidelon[0]+7)-(trancount*(-sidelon[0]+7)))
          // ctx.rect(sidelat[0],sidelon[0],50,50)
          // ctx.lineTo(sidelat[sidelat.length-1]*2,sidelon[sidelon.length-1]*2)
          trancount++
          // pixxdistarr.push(mod((sidelat[sidelat.length-1]-sidelat[sidelat.length-2])*50/mod((sidelat[1]-sidelat[0]))))
          // pixydistarr.push(mod((sidelon[sidelon.length-1]-sidelon[sidelon.length-2])*50/mod((sidelon[1]-sidelon[0]))))

          // pixxarr.push(pixxarr[pixxarr.length-1]+pixxdistarr[pixxdistarr.length-1])
          // pixyarr.push(pixyarr[pixyarr.length-1]+pixydistarr[pixydistarr.length-1])

          
          console.log("pixxarr",pixxarr)
          console.log("pixyarr",pixyarr)
          console.log("pixxdistarr",pixxdistarr)
          console.log("pixydistarr",pixydistarr)

          let xdiff = sidelat[1] - sidelat[0]
          let ydiff = sidelon[1] - sidelon[0] 

          console.log("xdiff",xdiff," ","ydiff",ydiff)

          if( noofside > 1 && sidelat[sidelat.length-1] == sidelat[0] && sidelon[sidelon.length-1] == sidelon[0]){
            //ctx.lineTo(7,(myCanvas.height/2)+30)
            // ctx.lineTo(7,7)
            // pixxarr.push(7)
            // pixyarr.push(7)
            console.log("shittt")
            ctx.lineTo(sidelat[0],sidelon[0])
          }
          else{
            ctx.lineTo(sidelat[sidelat.length-1]*12/xdiff,sidelon[sidelon.length-1]*12/ydiff)
            //  WORKING!!!
            // ctx.lineTo(sidelat[sidelat.length-1]*135/sidelat[0],sidelon[sidelon.length-1]*((myCanvas.height/2)+30)/sidelon[0])
            // ctx.lineTo(pixxarr[pixxarr.length-1],pixyarr[pixyarr.length-1])
          }

          if(noofside == 2){
          // ctx.rect((myCanvas.width/2)-distarr[0]*0.00005, (myCanvas.height/3), distarr[0]*0.00005, distarr[1]*0.00005);
          // ctx.rect((myCanvas.width/2)-distarr[0]*1.5, (myCanvas.height/3), distarr[0]*1.5, distarr[1]*1.5);
          // ctx.rect(60, 20, distarr[0]*3, distarr[1]*3);
          area = distarr[0]*distarr[1]
          enterarea.innerHTML = area
          ar.innerHTML = "Area:-"+" "+String(area)
          }
        }
        ctx.stroke()

        startcounter++
      })
      

      function solveeqn(a,b,c,d,e,f,xory){
    
    // for ax + by + c = 0
    //     dx + ey + f = 0

    let a1 = a*(d/a)
    let b1 = b*(d/a)
    let c1 = c*(d/a)
    let y = (f - c1)/(b1-e)
    let x = (-c-(b*y))/a
    
    if(xory == "x"){
        // console.log(x)
        return x
    }
    else{
    // console.log(y)
    return y
    }

    // LOGIC!!

    //a1x + b1y + c1 = 0
    //dx + ey + f
    //(b1-e)*y + (c1-f) =0
    //y = (f - c1)/(b1-e)
    
    //ax + by + c = 0
    //x = (-c-(b*y))/a
}
// console.log(solveeqnusingmult(5,4,-2,5,3,-1,"y"))

function slopeofline(x1,y1,x2,y2){
    
    let slope = (y2-y1)/(x2-x1)
    
    return slope
    
    // console.log(slope)
    
    }
    // slopeofline(2,2,1,1)
    
    function anglebetweentwolines(m1,m2){
    
    let angleoflines = mod((m2-m1)/(1+(m1*m2)))
    return angleoflines
    // console.log(angleoflines)
    }
    
    // anglebetweentwolines(2,1)
    // anglebetweentwolines(slopeofline(2,2,1,1),slopeofline(3,1,5,4))
    
    function mod(something){
        
        if(something < 0){
            return something*-1
        }
        else{
            return something
        }
    }

    function revmod(something){
        
        if(something > 0){
            return something*-1
        }
        else{
            return something
        }
    }

  //   function startup() {
  //   video = document.getElementById('video');
  //   canvas = document.getElementById('canvas');
  //   photo = document.getElementById('photo');
  //   startbutton = document.getElementById('startbutton');
  //   }

  //   navigator.mediaDevices
  // .getUserMedia({ video: true, audio: false })
  // .then((stream) => {
  //   video.srcObject = stream;
  //   video.play();
  // })
  // .catch((err) => {
  //   console.error(`An error occurred: ${err}`);
  // });

  const URL = "https://teachablemachine.withgoogle.com/models/cO36uER31/";

  let model, webcam, labelContainer, maxPredictions;

  // let startbutton = document.getElementById("startbutton")
  // let startbutton2 = document.getElementById("startbutton2")
  // startbutton2.style.display = "none"
  startbutton.addEventListener("click",async()=>{
    startbutton2.style.display = "block"
    startbutton.style.display = "none"
    

    const modelURL = URL + "model.json";
    const metadataURL = URL + "metadata.json";

    model = await tmImage.load(modelURL, metadataURL);
    maxPredictions = model.getTotalClasses();

    const flip = true; // whether to flip the webcam
        webcam = new tmImage.Webcam(300, 300, flip); // width, height, flip
        await webcam.setup({facingMode: "environment" }); // request access to the webcam
        await webcam.play();
        window.requestAnimationFrame(loop);

        document.getElementById("webcam-container").appendChild(webcam.canvas);
        labelContainer = document.getElementById("label-container");
        for (let i = 0; i < maxPredictions; i++) { // and class labels
            // labelContainer.appendChild(document.createElement("div"));
        }

        
          startbutton2.addEventListener("click",async ()=>{
            await webcam.pause();
            await predict();
            document.getElementById("webcam-container").style.display = "none"
            startbutton2.style.display = "none"
            
          })


  })

  async function loop() {
        webcam.update(); // update the webcam frame
        // await predict();
        window.requestAnimationFrame(loop);
    }

    // let plantdiagnose = document.getElementById("plantdiagnose")
    
    let healthtext;
    // let healthTextarea = document.getElementById("healthTextarea")
    async function predict() {
      let plantdiagnosevalue = plantdiagnose.value
      console.log(plantdiagnosevalue)
        // predict can take in an image, video or canvas html element
        const prediction = await model.predict(webcam.canvas);
        for (let i = 0; i < maxPredictions; i++) {
            const classPrediction =
            prediction[i].className + ": " + prediction[i].probability.toFixed(2);
            // labelContainer.childNodes[i].innerHTML = classPrediction;
            
            if(prediction[0].probability.toFixed(2) > prediction[1].probability.toFixed(2) && prediction[0].probability.toFixed(2) > prediction[2].probability.toFixed(2) && prediction[0].probability.toFixed(2) > prediction[3].probability.toFixed(2)){
            // console.log("0 big")
            // break;
            healthtext = "Is"+" "+String(plantdiagnosevalue)+" "+"plant with leaves having"+" "+String(prediction[0].className)+" "+"healthy, if not which disease does it have and how to treat it"
            
            
            }
            
            else if(prediction[1].probability.toFixed(2) > prediction[0].probability.toFixed(2) && prediction[1].probability.toFixed(2) > prediction[2].probability.toFixed(2) && prediction[1].probability.toFixed(2) > prediction[3].probability.toFixed(2)){
              console.log("1 big")
              // break;
              healthtext = "Is"+" "+String(plantdiagnosevalue)+" "+"plant with leaves having"+" "+String(prediction[1].className)+" "+"healthy, if not which disease does it have and how to treat it"
            }

            
            else if(prediction[2].probability.toFixed(2) > prediction[0].probability.toFixed(2) && prediction[2].probability.toFixed(2) > prediction[1].probability.toFixed(2) && prediction[2].probability.toFixed(2) > prediction[3].probability.toFixed(2)){
              console.log("2 big")
              // break;
              healthtext = "Is"+" "+String(plantdiagnosevalue)+" "+"plant with leaves having"+" "+String(prediction[2].className)+" "+"healthy, if not which disease does it have and how to treat it"
            }

            else{
              console.log("3 big")
              healthtext = "Is"+" "+String(plantdiagnosevalue)+" "+"plant with leaves having"+" "+String(prediction[3].className)+" "+"healthy, if not which disease does it have and how to treat it"
              // break;
            }

            if (healthtext) {
        try {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${API_KEY}`,
                },
                body: JSON.stringify({
                    model: 'gpt-4',
                    messages: [{ role: 'user', content: healthtext }],
                    temperature: 1.0,
                    top_p: 0.7,
                    n: 1,
                    stream: false,
                    presence_penalty: 0,
                    frequency_penalty: 0,
                }),
            });

            if (response.ok) {
                const data = await response.json();
                healthTextarea.value = data.choices[0].message.content;
                break;
            } else {
                healthTextarea.value = 'Error: Unable to process your request.';
            }
        } catch (error) {
            console.error(error);
            healthTextarea.value = 'Error: Unable to process your request.';
        }
    }


        }
    }
    </script>
  </body>
</html>
